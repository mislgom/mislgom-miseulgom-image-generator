# 🐻 미슬곰 이미지 자동 생성기 v2.0.1 - 완전 무료 버전

**AI 기반 스토리보드 자동 생성 솔루션 (로컬 GPU 활용)**

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Status: Production Ready](https://img.shields.io/badge/Status-Production%20Ready-brightgreen.svg)](https://github.com)
[![Version: 2.0.1](https://img.shields.io/badge/Version-2.0.1-blue.svg)](https://github.com)

---

## 🔧 v2.0.1 버그 수정 및 UI 개선 (2026-01-17)

### 수정사항
- 🐛 **파일 업로드 버튼 수정**: 웹 미리보기 환경에서 파일 업로드가 작동하지 않던 문제 해결
  - `display: none !important` → `position: absolute; opacity: 0` 방식으로 변경
  - 브라우저 보안 정책 준수 및 접근성 개선
  - 파일 입력 요소의 클릭 이벤트 활성화
- 🖼️ **스타일 이미지 순서 정렬**: 이미지와 설명이 일치하도록 순서 재정렬
  - 각 스타일 썸네일과 설명의 매칭 정확도 개선

### UI 개선
- 🎨 **이미지 라이트박스 개선**: 클릭 방식 → 호버 방식으로 변경
  - 마우스 오버 시 자동으로 미리보기 표시
  - 마우스가 벗어나면 자동으로 닫힘
  - 더 직관적이고 빠른 미리보기 경험 제공
  - 부드러운 페이드 인 애니메이션 (0.2초)
- ✨ **빈 상태 메시지 개선**: 등장인물/스토리보드 빈 화면 UI 향상
  - 섹션 기준 완전한 중앙 정렬 (`:has()` 선택자 활용)
  - 아이콘 크기 확대 및 부드러운 애니메이션 효과
  - 텍스트 가독성 향상 및 색상 대비 개선
- 🖼️ **스타일 이미지 고화질 교체**: 9개 스타일 프리뷰 이미지를 고해상도 버전으로 교체
  - 외부 호스팅(ibb.co) → 로컬 이미지(images/) 폴더로 변경
  - 평균 130KB 고품질 JPEG 이미지 사용
  - 라이트박스 미리보기 화질 대폭 개선
- 📐 **비율 기본값 변경**: 초기 비율 선택을 1:1 → 16:9로 변경
  - 가장 많이 사용되는 유튜브/웹 콘텐츠 비율을 기본값으로 설정
  - 1344x768 고해상도 출력

---

## 🎉 v2.0 주요 업데이트 (2026-01-17)

### 🆕 신기능
1. **등장인물 자동 추출**: Gemini API가 대본에서 인물을 자동 감지
2. **Visual Trigger Rule**: 시각적 변화 감지 기반 장면 수 계산
3. **ADetailer 얼굴 보정**: YOLOv8 기반 자동 얼굴 디테일 향상
4. **Animagine XL 지원**: 애니메이션 스타일 전용 모델 자동 전환
5. **System Instruction**: Gemini AI가 역할을 정확히 이해

### 🔧 개선사항
- 해상도 최적화: 1344x768 (16:9 고품질)
- 스타일 9종으로 확장 (한국 야담 4종, 일본 애니 2종, 실사/영화 3종)
- 한글/영문 프롬프트 완전 분리 (UI=한글, API=영문)
- JSON 강제 모드로 안정성 향상

---

## 📋 개요

**미슬곰 이미지 자동 생성기**는 대본을 입력하면 AI가 자동으로:
1. **등장인물 추출** (이름, 외형, 특징)
2. **장면 수 계산** (시각적 변화 감지)
3. **이미지 생성** (로컬 GPU, 무제한)

을 수행하는 웹 애플리케이션입니다.

### 💰 완전 무료 아키텍처
- **이미지 생성**: Stable Diffusion WebUI (로컬 GPU, 무제한)
- **대본 분석**: Gemini API (무료 월 1,500회) 또는 규칙 기반
- **총 비용**: **$0** (전기세 제외)

### 주요 기능 (v2.0 - 2026-01-17 대규모 업데이트)

#### 🎬 대본 관리
- ✅ **파트별 대본 입력**: Intro + Part 1~10 (파트당 최대 10,000자)
- ✅ **드래그앤드롭 업로드**: TXT 파일을 드래그하여 간편하게 대본 업로드
- ✅ **파트 수 동적 선택**: 1~10개 파트를 자유롭게 선택

#### 🤖 AI 분석 (v2.0 신기능)
- ✅ **Gemini 1.5 Flash System Instruction**: AI가 역할을 정확히 이해
- ✅ **등장인물 자동 추출**: 대본에서 인물을 자동으로 감지하고 추출
  - 한글/영문 이름 자동 생성
  - 시각적 묘사 자동 생성 (한글/영문 분리)
- ✅ **Visual Trigger Rule**: 시각적 변화 감지 기반 장면 수 계산
  - 장소 변화 감지
  - 인물 등장/퇴장 감지
  - 행동 전환 감지
  - 감정/분위기 변화 감지
- ✅ **JSON 강제 모드**: 정확한 구조화된 데이터 반환
- ✅ **규칙 기반 폴백**: API 없이도 작동

#### 🎨 이미지 생성 (로컬 GPU) (v2.0 업그레이드)
- ✅ **해상도**: 1344x768 (16:9 고품질, 2026 최신 표준)
- ✅ **비율**: 1:1, 16:9, 9:16 (4:3, 3:4 제거)
- ✅ **스타일 9종**: 
  - 한국 야담 (4종): 고퀄리티 웹툰, 동화 일러스트, 전통 수묵화, 심플 2D 만화
  - 일본 애니 (2종): 감성 애니메이션, 극화체 애니메이션
  - 실사/영화 (3종): 다큐멘터리 포토, 영화 실사, 판타지/SF
- ✅ **Animagine XL 자동 전환**: 애니메이션 스타일 선택 시 전용 모델로 자동 전환 (코드 구현 완료)
- ✅ **ADetailer 얼굴 보정**: 얼굴 디테일 자동 향상 (YOLOv8 기반)
- ✅ **인종 선택**: 한국인/일본인/서양인/흑인

#### 🖼️ 이미지 수정 (v2.0 개선)
- ✅ **img2img**: 기존 이미지를 수정 (프롬프트 기반)
- ✅ **ADetailer 적용**: 수정 시에도 얼굴 보정 자동 적용
- ✅ **히스토리**: 버전 관리 및 복원

#### 📦 다운로드
- ✅ **엑셀**: 이미지 삽입, 가운데 정렬, 프롬프트 자동 줄바꿈
- ✅ **사진 ZIP**: 모든 이미지 원본 다운로드

#### 💾 프로젝트 관리
- ✅ **LocalStorage**: 자동 저장 및 다중 프로젝트 관리
- ✅ **내보내기/가져오기**: JSON 백업/복원

---

## 🚀 빠른 시작

### 필수 요구사항

1. **Stable Diffusion WebUI 설치** (필수)
   - 📖 상세 가이드: [SETUP_GUIDE.md](SETUP_GUIDE.md)
   - 설치 시간: 약 30분
   - 디스크 공간: 약 20GB (모델 포함)
   - **🆕 필수 확장**: ADetailer Extension 설치 필요

2. **모델 다운로드** (필수 2개)
   - **Juggernaut XL v9**: 기본 모델 (7가지 스타일: 웹툰, 동화, 수묵화, 2D 만화, 실사, 다큐, 영화, SF)
   - **Animagine XL v3.1**: 애니메이션 전용 모델 (2가지 스타일: 감성 애니, 극화체 애니) ✨ **강력 권장**
   - 저장 경로: `models/Stable-diffusion/`
   - **자동 전환**: 스타일 선택 시 웹사이트가 자동으로 적절한 모델로 전환

3. **Gemini API 키 발급** (선택, 무료)
   - 🔗 https://aistudio.google.com/app/apikey
   - 무료 할당량: 월 1,500회
   - **v2.0 기능**: 등장인물 자동 추출, Visual Trigger Rule
   - 없어도 프로그램 작동 (규칙 기반 폴백)

4. **권장 PC 사양**
   - CPU: Intel i7 이상
   - RAM: 16GB 이상 (32GB 권장)
   - GPU: NVIDIA RTX 3060 이상 (8GB VRAM)
   - OS: Windows 10/11 (WSL2 지원)

---

## 🚀 시작하기

### 1. Stable Diffusion WebUI 실행

```powershell
cd C:\stable-diffusion-webui
.\webui-user.bat
```

브라우저에 `http://localhost:7860` 열림 → **API 준비 완료!**

### 2. 프로젝트 클론 (또는 다운로드)

```bash
git clone https://github.com/yourusername/miseulgom-image-generator.git
cd miseulgom-image-generator
```

### 3. 로컬 서버 실행

**방법 1: Python (권장)**
```bash
python -m http.server 8080
```

**방법 2: Node.js (http-server)**
```bash
npx http-server -p 8080
```

**방법 3: 파일 직접 열기**
```
index.html 더블클릭
```

### 4. 브라우저에서 열기

```
http://localhost:8080
```

### 5. Gemini API 키 입력 (선택)

1. 프로그램 실행
2. 좌측 사이드바 → **"고급 설정"**
3. **"🤖 Gemini API 키"** 입력 (없으면 규칙 기반 분석 사용)

---

## 📖 사용 흐름 (v2.0 업데이트)

### 1️⃣ 대본 입력
1. 파트 수 선택 (1-10개)
2. 각 파트에 대본 입력 (또는 TXT 파일 드래그앤드롭)

### 2️⃣ 대본 분석 (🆕 자동화)
1. **"종합 대본 분석"** 버튼 클릭
2. AI가 자동으로:
   - 등장인물 추출 (이름, 외형, 특징)
   - 시각적 변화 감지 (Visual Trigger Rule)
   - 장면 수 자동 계산
3. 원하는 이미지 수 선택 또는 직접 입력

### 3️⃣ 인물/스타일 설정
1. 인종: 한국인/일본인/서양인/흑인
2. 스타일 9종:
   - 한국 야담: 고퀄리티 웹툰, 동화 일러스트, 전통 수묵화, 심플 2D 만화
   - 일본 애니: 감성 애니메이션, 극화체 애니메이션
   - 실사/영화: 다큐멘터리 포토, 영화 실사, 판타지/SF
3. 비율: 1:1, 16:9 (1344x768), 9:16

### 4️⃣ 등장인물 생성 (🆕 자동 추출)
1. AI가 추출한 등장인물 목록 확인
2. **"등장인물 생성"** 클릭
3. 로컬 GPU가 이미지 생성 (약 5-10초/장)
4. **ADetailer 얼굴 보정 자동 적용**

### 5️⃣ 스토리보드 생성
1. **"스토리보드 생성"** 클릭
2. 파트별 장면 자동 생성
3. **Animagine XL 자동 전환** (애니메이션 스타일 선택 시)

### 6️⃣ 이미지 수정 (선택)
1. 이미지 클릭 → 상세 모달
2. **"수정 요청"** 입력 (예: "배경을 밤으로 변경")
3. **"✨ 수정 적용 및 재생성"** 클릭
4. **ADetailer 얼굴 보정 자동 적용**

### 7️⃣ 다운로드
1. **사진 ZIP**: 모든 이미지 원본 다운로드
2. **엑셀 파일**: 이미지 + 프롬프트 포함
- **전체 다운로드 (사진)**: ZIP 파일
- **전체 다운로드 (엑셀)**: 이미지 포함 엑셀

---

## 📊 성능 예상 (RTX 3070 Ti 기준)

| 작업 | 소요 시간 | 비용 |
|------|-----------|------|
| 대본 분석 (Gemini) | 2-5초 | 무료 |
| 등장인물 생성 (5명) | 50-75초 | 무료 |
| 스토리보드 (50장) | 8-12분 | 무료 |
| 이미지 수정 (1장) | 10-15초 | 무료 |

**총 비용: $0** (전기세 약 ₩100-200/시간)

---

## 🎨 이미지 품질

| 해상도 | 속도 (RTX 3070 Ti) | 품질 |
|--------|-------------------|------|
| 512x512 | 2-3초 | ⭐⭐⭐ |
| 768x768 | 5-7초 | ⭐⭐⭐⭐ |
| **1024x1024** | **10-15초** | **⭐⭐⭐⭐⭐** |
| 1280x1280 | 20-25초 | ⭐⭐⭐⭐⭐ |

**기본 해상도: 1024px (1K) - nano-banana-pro급 품질**

---

```
http://localhost:8000
```

또는 `index.html` 파일을 브라우저에서 직접 열 수 있습니다.

## 📖 사용 가이드

### 1. 파트 설정

좌측 사이드바에서 **파트 수**를 선택합니다 (1~10개).

- **Intro (콜드오픈)**: 오프닝 장면
- **Part 1 ~ 10**: 본편 구성

### 2. 대본 입력

#### 방법 1: 직접 입력
각 파트 탭에서 대본을 직접 입력합니다.
- 파트당 최대 **10,000자**
- 실시간 글자 수 표시

#### 방법 2: 파일 업로드
TXT 파일을 드래그 앤 드롭하거나 파일 선택 버튼을 클릭합니다.

**파트 자동 인식 형식:**
```
=== 파트1 ===
여기에 대본 내용...

=== 파트2 ===
여기에 대본 내용...
```

**또는:**
```
[파트1]
여기에 대본 내용...

[파트2]
여기에 대본 내용...
```

**일본어:**
```
=== パート1 ===
ここにスクリプト内容...

=== パート2 ===
ここにスクリプト内容...
```

### 3. 종합 대본 분석

**종합 대본 분석** 버튼을 클릭합니다.

1. AI가 각 파트별 대본을 분석
2. 장면 전환 자동 감지
3. 3가지 이미지 수 옵션 제시:

| 옵션 | 설명 | 예시 |
|------|------|------|
| **전체 장면** | 모든 장면 전환마다 이미지 생성 | 50장 |
| **중요 장면** (권장) | 주요 장면만 이미지 생성 | 35장 |
| **최소 장면** | 필수 장면만 이미지 생성 | 20장 |

4. **직접 입력**으로 원하는 이미지 수 설정 가능
5. 각 파트별로 개별 조정 가능

### 4. 인물 및 스타일 설정

- **인물 인종**: 한국인, 일본인, 서양인, 흑인 선택
- **이미지 스타일**: 사실적, 몽환적, 수채화, 애니메이션
- **화질**: 1K (빠름), 2K (권장), 4K (최고 품질)
- **비율**: 16:9 (가로), 9:16 (세로), 1:1 (정사각형), 4:3

### 5. 등장인물 생성

1. 대본 분석 완료 후 **등장인물 생성** 버튼 클릭
2. AI가 자동으로 주요 등장인물 추출
3. 각 인물의 이미지 자동 생성
4. 프롬프트(한글/영문) 자동 생성

**등장인물 카드 기능:**
- 클릭: 상세 모달 (프롬프트 확인/수정, 히스토리)
- 재생성: 이미지 재생성 (버전 히스토리 저장)
- 다운로드: 개별 이미지 다운로드

### 6. 스토리보드 생성

1. 등장인물 생성 완료 후 **스토리보드 생성** 버튼 클릭
2. 대본 구간별로 이미지 자동 생성
3. 등장인물 일관성 유지
4. 파트별 필터링 가능

**스토리보드 카드 기능:**
- 클릭: 상세 모달 (대본 구간, 프롬프트, 히스토리)
- 재생성: 장면 이미지 재생성
- 다운로드: 개별 이미지 다운로드

### 7. 전체 다운로드

#### 등장인물 다운로드
- **엑셀 파일** (`등장인물_YYYYMMDD_HHMM.xlsx`)
  | 이미지 | 이름 | 영문 이름 | 한글 프롬프트 | 영문 프롬프트 |
  |--------|------|-----------|---------------|---------------|
  | (이미지) | 윤해린 | Yoon Haerin | ... | ... |

- **ZIP 파일** (`등장인물_이미지_YYYYMMDD_HHMM.zip`)
  - `characters/윤해린_Yoon_Haerin.png`
  - `characters/백도식_Baek_Dosik.png`
  - ...

#### 스토리보드 다운로드
- **엑셀 파일** (`스토리보드_YYYYMMDD_HHMM.xlsx`)
  - 파트별로 시트 분리 (파트 1, 파트 2, ...)
  
  | 이미지 | 장면 번호 | 대본 구간 | 한글 프롬프트 | 영문 프롬프트 |
  |--------|-----------|-----------|---------------|---------------|
  | (이미지) | 장면 1 | 어두운 밤... | ... | ... |

- **ZIP 파일** (`스토리보드_이미지_YYYYMMDD_HHMM.zip`)
  - `part1/scene_001.png`
  - `part1/scene_002.png`
  - `part2/scene_001.png`
  - ...

### 8. 프로젝트 관리 (📁 버튼)

오른쪽 위의 **📁 폴더 아이콘**을 클릭하면 프로젝트 관리 메뉴가 열립니다:

| 메뉴 항목 | 아이콘 | 기능 설명 | 단축키 |
|----------|--------|----------|--------|
| **새 프로젝트** | 📄 | 현재 작업을 초기화하고 새 프로젝트 시작 | - |
| **저장** | 💾 | 현재 작업을 LocalStorage에 저장 | Ctrl+S |
| **불러오기** | 📂 | 저장된 프로젝트 목록에서 선택하여 불러오기 | - |
| **프로젝트 내보내기 (JSON)** | 📤 | 프로젝트를 JSON 파일로 내보내기 (백업용) | - |
| **프로젝트 가져오기 (JSON)** | 📥 | JSON 파일에서 프로젝트 가져오기 (복원용) | - |

**자동 저장**: 대본 입력 시 3초 딜레이로 LocalStorage에 자동 저장됩니다.

### 9. 키보드 단축키

- **Ctrl + S**: 프로젝트 저장
- **ESC**: 모달 닫기

## 🏗️ 프로젝트 구조

```
miseulgom-image-generator/
├── index.html              # 메인 HTML 파일
├── styles/
│   ├── main.css           # 기본 스타일시트
│   └── additional.css     # 추가 스타일시트
├── scripts/
│   ├── api.js             # API 통신 모듈
│   ├── ui.js              # UI 관리 모듈
│   ├── projectManager.js  # 프로젝트 관리 모듈
│   ├── scriptManager.js   # 대본 관리 모듈 (파트 관리, AI 분석)
│   ├── characterManager.js # 등장인물 관리 모듈
│   ├── storyboardManager.js # 스토리보드 관리 모듈
│   ├── excelExport.js     # 엑셀 내보내기 모듈
│   └── app.js             # 메인 애플리케이션
├── README.md              # 프로젝트 문서
├── DEPLOY_GUIDE.md        # 배포 가이드
├── USER_GUIDE.md          # 사용자 가이드
└── vercel.json            # Vercel 배포 설정
```

## 🔧 기술 스택

### 프론트엔드
- **HTML5**: 시맨틱 마크업
- **CSS3**: 변수, 그리드, Flexbox, 애니메이션
- **JavaScript (ES6+)**: 모듈 패턴, Async/Await

### 라이브러리
- **SheetJS (xlsx)**: 엑셀 파일 생성
- **JSZip**: ZIP 파일 생성
- **FileSaver.js**: 파일 다운로드

### 데이터 저장
- **LocalStorage**: 프로젝트 및 설정 저장

### 백엔드 (선택사항)
- **FastAPI**: Python 기반 REST API
- **PostgreSQL**: 데이터베이스
- **Railway**: 백엔드 배포

## 🌐 배포

### Vercel (권장)

1. **Vercel CLI 설치**
```bash
npm install -g vercel
```

2. **배포**
```bash
vercel --prod
```

### GitHub Pages

1. **Settings > Pages**에서 소스 선택
2. 브랜치: `main`, 폴더: `/` (root)
3. 저장 후 URL 확인

### Netlify

1. **Netlify CLI 설치**
```bash
npm install -g netlify-cli
```

2. **배포**
```bash
netlify deploy --prod
```

## 📊 현재 구현 상태

### ✅ 완료된 기능

- [x] 파트 수 선택 (1~10)
- [x] 파트별 대본 입력 (최대 10,000자)
- [x] 파트 탭 전환 (Intro, Part 1~10)
- [x] 대본 파일 업로드 (자동 파트 분할)
- [x] **종합 대본 분석** (AI 장면 전환 감지)
- [x] **이미지 수 선택 모달** (전체/중요/최소 + 직접 입력)
- [x] 등장인물 자동 추출
- [x] 등장인물 카드 UI (정사각형 그리드)
- [x] 스토리보드 카드 UI (3열 그리드)
- [x] 이미지 상세 모달 (프롬프트, 히스토리, 수정 요청)
- [x] 엑셀 다운로드 (이미지 삽입 + ZIP)
- [x] 프로젝트 관리 (LocalStorage)
- [x] 다크/라이트 모드
- [x] 키보드 단축키
- [x] 반응형 디자인

### 🚧 진행 중 / 향후 계획

- [ ] 백엔드 API 연동
- [ ] 실제 AI 이미지 생성 API 연동
- [ ] LLM 기반 대본 분석 및 등장인물 추출
- [ ] 프롬프트 최적화 및 자동 생성
- [ ] 이미지 편집 기능
- [ ] 사용자 인증 및 계정 관리
- [ ] 클라우드 스토리지 연동

## 🎬 워크플로우

```
1. 파트 수 선택 (1~10)
   ↓
2. 대본 입력 (직접 입력 또는 파일 업로드)
   ↓
3. 종합 대본 분석
   ↓ (AI가 장면 전환 분석)
4. 이미지 수 선택
   • 전체 장면 (예: 50장)
   • 중요 장면 (예: 35장) ← 권장
   • 최소 장면 (예: 20장)
   • 직접 입력
   ↓
5. 등장인물 생성
   ↓ (각 인물의 이미지 생성)
6. 스토리보드 생성
   ↓ (대본 구간별 이미지 생성)
7. 전체 다운로드
   • 등장인물: Excel + ZIP
   • 스토리보드: Excel + ZIP (파트별)
```

## 🐛 알려진 이슈

- 데모 모드: 현재 임시 이미지 사용 (Unsplash)
- 백엔드 미연동: API 호출 시 데모 데이터 반환
- 엑셀 이미지 삽입: 현재 이미지 URL만 삽입 (실제 이미지 임베드 예정)

## 🤝 기여

기여는 언제나 환영합니다!

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

## 📝 라이센스

이 프로젝트는 MIT 라이센스 하에 배포됩니다. 자세한 내용은 `LICENSE` 파일을 참조하세요.

## 📧 문의

- **Email**: [dev@miseulgom.com](mailto:dev@miseulgom.com)
- **GitHub**: [https://github.com/yourusername/miseulgom-image-generator](https://github.com/yourusername/miseulgom-image-generator)

## 🙏 감사의 말

- **Unsplash**: 데모 이미지 제공
- **SheetJS**: 엑셀 파일 생성
- **JSZip**: ZIP 파일 생성
- **FileSaver.js**: 파일 다운로드

---

**Made with ❤️ by Miseulgom Team**

---

## 📝 v2.0 변경사항 상세 (2026-01-17)

### 🆕 신기능

#### 1. Gemini API System Instruction
- AI가 역할을 명확히 이해하도록 시스템 지시문 추가
- 등장인물 추출 전문가로 설정
- Visual Trigger Rule 적용 가이드 포함

#### 2. 등장인물 자동 추출
**이전**: 하드코딩된 데모 데이터  
**현재**: Gemini API가 대본에서 자동 감지

**추출 정보**:
- 한글 이름 (예: 윤해린)
- 영문 이름 (예: Yoon Haerin)
- 한글 시각적 묘사 (UI 표시용)
- 영문 시각적 묘사 (이미지 생성용)

#### 3. Visual Trigger Rule (시각적 변화 감지)
**이전**: 글자 수 기반 계산  
**현재**: 4가지 시각적 트리거 감지

**트리거 종류**:
1. **장소 변화**: 집 → 거리 → 숲
2. **인물 등장/퇴장**: 주요 인물 등장
3. **행동 전환**: 걷기 → 싸움 → 대화
4. **감정 변화**: 평온 → 긴장 → 슬픔

#### 4. ADetailer 얼굴 보정
**기능**:
- YOLOv8 기반 얼굴 자동 감지
- 얼굴 디테일 향상 (눈, 피부, 표정)
- txt2img와 img2img 모두 지원
- 보정 강도 자동 조절 (txt2img=0.4, img2img=0.35)

**효과**:
- 더 자연스러운 피부 표현
- 선명한 눈동자
- 정확한 얼굴 비율
- 일관된 얼굴 특징

#### 5. Animagine XL 자동 전환
**대상 스타일**:
- 감성 애니메이션 (Makoto Shinkai 스타일)
- 극화체 애니메이션 (Ufotable 스타일)

**동작**:
- 스타일 선택 시 자동으로 `animagineXL_v31.safetensors` 모델 로드
- 애니메이션 특화 프롬프트 적용

### 🔧 개선사항

#### 1. 해상도 최적화
**변경 전**: 1024x1024 (1:1 기준)  
**변경 후**: 1344x768 (16:9 기준, 2026 영상 표준)

#### 2. 스타일 확장
**변경 전**: 4종 (Realistic, Dreamlike, Watercolor, Anime)  
**변경 후**: 9종 (한국 야담 4종, 일본 애니 2종, 실사/영화 3종)

**새로운 스타일**:
- 고퀄리티 웹툰
- 동화 일러스트
- 전통 수묵화
- 심플 2D 만화
- 감성 애니메이션
- 극화체 애니메이션
- 다큐멘터리 포토
- 영화 실사
- 판타지/SF

#### 3. 비율 간소화
**변경 전**: 1:1, 16:9, 9:16, 4:3, 3:4 (5종)  
**변경 후**: 1:1, 16:9, 9:16 (3종)

**이유**: 4:3과 3:4는 사용 빈도가 낮고 16:9가 영상 표준

#### 4. 한글/영문 완전 분리
- UI: 한글 프롬프트 표시
- API: 영문 프롬프트 전송
- 등장인물: descriptionKo + descriptionEn 분리 저장

### 🐛 버그 수정

1. JSON 파싱 오류 → JSON 강제 모드로 해결
2. 스타일별 모델 불일치 → 자동 전환 로직 추가
3. 얼굴 디테일 부족 → ADetailer 추가

### 📦 필수 설치 항목 추가

1. **ADetailer Extension** (Stable Diffusion WebUI)
2. **Animagine XL v3.1** 모델 (선택)
3. **face_yolov8n.pt** 얼굴 감지 모델

---

## 🔧 개발자를 위한 기술 문서

### API 변경사항

#### Gemini API 응답 형식 변경
**v1.0 (이전)**:
```json
{
  "intro": {
    "charCount": 1234,
    "totalScenes": 20,
    "importantScenes": 14,
    "minimalScenes": 8
  }
}
```

**v2.0 (현재)**:
```json
{
  "characters": [
    {
      "name": "윤해린",
      "nameEn": "Yoon Haerin",
      "descriptionKo": "20대 초반 여성, 긴 검은 머리...",
      "descriptionEn": "young woman in her early 20s..."
    }
  ],
  "scenes": {
    "intro": {
      "charCount": 1234,
      "visualTriggers": ["장소 변화: 집→거리", "인물 등장: 백도식"],
      "totalScenes": 20,
      "importantScenes": 14,
      "minimalScenes": 8
    }
  }
}
```

#### Stable Diffusion API 파라미터 추가
**v2.0 추가**:
```javascript
{
  "alwayson_scripts": {
    "ADetailer": {
      "args": [{
        "ad_model": "face_yolov8n.pt",
        "ad_prompt": "high quality, detailed face",
        "ad_denoising_strength": 0.4
      }]
    }
  }
}
```

---

## 📚 관련 문서

- [SPECIFICATION_ANALYSIS.md](SPECIFICATION_ANALYSIS.md) - 개발 명세서 상세 분석
- [SETUP_GUIDE.md](SETUP_GUIDE.md) - Stable Diffusion WebUI 설치 가이드
- [USER_GUIDE.md](USER_GUIDE.md) - 사용자 매뉴얼
- [DEPLOY_GUIDE.md](DEPLOY_GUIDE.md) - 배포 가이드

---

**Author**: 미슬곰 Team  
**Version**: 2.0  
**Last Updated**: 2026-01-17
